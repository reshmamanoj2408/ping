<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_261) on Wed May 17 21:45:42 UTC 2023 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>MasterKeyEncryptor (PingFederate Server SDK)</title>
<meta name="date" content="2023-05-17">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="MasterKeyEncryptor (PingFederate Server SDK)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":6,"i1":6,"i2":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/MasterKeyEncryptor.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../../com/pingidentity/sdk/key/MasterKeyEncryptorException.html" title="class in com.pingidentity.sdk.key"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/pingidentity/sdk/key/MasterKeyEncryptor.html" target="_top">Frames</a></li>
<li><a href="MasterKeyEncryptor.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.pingidentity.sdk.key</div>
<h2 title="Interface MasterKeyEncryptor" class="title">Interface MasterKeyEncryptor</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public interface <span class="typeNameLabel">MasterKeyEncryptor</span></pre>
<div class="block"><p>
 An encryptor that can be used to encrypt PingFederate's master key file (pf.jwk).
 </p>
 <p>
 The encryptor can return a key identifier (via its initialize method) which can
 be associated with the master key file. This allows PingFederate configuration
 archives to be transferred between different installations. Alternatively, a null
 key identifier can be returned if the encryptor chooses to manage its key identifier
 for certain deployment requirements, such as tying the key to the machine's MAC
 address.
</p>
<p>
 If a master key file was previously unencrypted, it will be immediately
 encrypted after initialization. If a key identifier is returned and has changed,
 then the master key file be decrypted and then encrypted immediately after to
 allow the encryptor to apply the new key.
 </p>
 <p>
 The key identifier is stored in the
 '&lt;PF_INSTALL&gt;/server/default/data/config-store/com.pingidentity.crypto.jwk.MasterKeySet.xml'
 file.
 </p>
 <p>
 An encryptor implementation must be deployed to the directory
 '&lt;PF_INSTALL&gt;/server/default/deploy/' and declared for use in
 '&lt;PF_INSTALL&gt;/server/default/conf/META-INF/hivemodule.xml', in the MasterKeyEncryptor's
 create-instance class attribute. i.e.
 </p>
 <pre>
 <code>
 &lt;service-point id="MasterKeyEncryptor" interface="com.pingidentity.sdk.key.MasterKeyEncryptor"&gt;
     &lt;create-instance class="com.company.MyMasterKeyEncryptor"/&gt;
 &lt;/service-point&gt;
 </code>
 </pre>
 <h3>Disabling Revocation Checking</h3>
 <p>
 A circular initialization dependency can arise if revocation checking is enabled in PingFederate
 and a <code>MasterKeyEncryptor</code> implementation makes API calls to an external service. To
 avoid this risk, revocation checking should be disabled for any API calls made by the master key
 encryptor. The following code shows how a custom trust manager can be created that uses the trust
 anchors from Java's <code>cacerts</code> file and has revocation checking disabled.
 </p>
 <pre>
     private static TrustManager[] getCaCertsTrustManagers()
     {
         String javaHome = System.getProperty("java.home");
         if (javaHome == null)
         {
             throw new IllegalStateException("Expected java.home system property to be set");
         }

         Path cacerts = Paths.get(javaHome).resolve(Paths.get("lib/security/cacerts"));

         try (InputStream inputStream = Files.newInputStream(cacerts))
         {
             KeyStore ks = KeyStore.getInstance("JKS");
             ks.load(inputStream, null);

             TrustManagerFactory trustManagerFactory =
                     TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());

             PKIXBuilderParameters params = new PKIXBuilderParameters(ks, new X509CertSelector());
             params.setRevocationEnabled(false);
             trustManagerFactory.init(new CertPathTrustManagerParameters(params));

             return trustManagerFactory.getTrustManagers();
         }
         catch (IOException | GeneralSecurityException e)
         {
             throw new IllegalStateException("Failed to create trust manager", e);
         }
     }
 </pre></div>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>8.0</dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>byte[]</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/pingidentity/sdk/key/MasterKeyEncryptor.html#decrypt-byte:A-">decrypt</a></span>(byte[]&nbsp;cipherText)</code>
<div class="block">Decrypts the master key's cipher text.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>byte[]</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/pingidentity/sdk/key/MasterKeyEncryptor.html#encrypt-byte:A-">encrypt</a></span>(byte[]&nbsp;plainText)</code>
<div class="block">Encrypts the data that will eventually be stored in the master key file.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../com/pingidentity/sdk/key/MasterKeyEncryptor.html#initialize-java.lang.String-">initialize</a></span>(<a href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;keyId)</code>
<div class="block">
 Initializes the <code>MasterKeyEncryptor</code> allowing implementations
 to perform any external key management operations, such as creating/loading
 an external key.</div>
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="initialize-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>initialize</h4>
<pre><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;initialize(<a href="http://docs.oracle.com/javase/7/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;keyId)
           throws <a href="../../../../com/pingidentity/sdk/key/MasterKeyEncryptorException.html" title="class in com.pingidentity.sdk.key">MasterKeyEncryptorException</a></pre>
<div class="block"><p>
 Initializes the <code>MasterKeyEncryptor</code> allowing implementations
 to perform any external key management operations, such as creating/loading
 an external key.
 </p>
 <p>
 The key identifier that is used to encrypt/decrypt the master key file is
 passed into the initialize method. The key identifier may be null if the
 master key file was not previously encrypted, or if this <code>MasterKeyEncryptor</code>
 doesn't need a key identifier and previously returned null in an earlier
 initialization.
 </p>
 <p>
 This method is called everytime a master key file is loaded. This can occur when
 PingFederate starts up or when a configuration archive is imported.
 </p></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>keyId</code> - The key identifier associated with the master key file. May be null.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The key identifier to associate with the master key file. Can be null.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../com/pingidentity/sdk/key/MasterKeyEncryptorException.html" title="class in com.pingidentity.sdk.key">MasterKeyEncryptorException</a></code> - Thrown if failed to initialize.</dd>
</dl>
</li>
</ul>
<a name="encrypt-byte:A-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>encrypt</h4>
<pre>byte[]&nbsp;encrypt(byte[]&nbsp;plainText)
        throws <a href="../../../../com/pingidentity/sdk/key/MasterKeyEncryptorException.html" title="class in com.pingidentity.sdk.key">MasterKeyEncryptorException</a></pre>
<div class="block">Encrypts the data that will eventually be stored in the master key file.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>plainText</code> - The master key file's plain text content.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The cipher text that will be saved to the master key file.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../com/pingidentity/sdk/key/MasterKeyEncryptorException.html" title="class in com.pingidentity.sdk.key">MasterKeyEncryptorException</a></code> - Thrown if failed to encrypt.</dd>
</dl>
</li>
</ul>
<a name="decrypt-byte:A-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>decrypt</h4>
<pre>byte[]&nbsp;decrypt(byte[]&nbsp;cipherText)
        throws <a href="../../../../com/pingidentity/sdk/key/MasterKeyEncryptorException.html" title="class in com.pingidentity.sdk.key">MasterKeyEncryptorException</a></pre>
<div class="block">Decrypts the master key's cipher text.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>cipherText</code> - The master key's cipher text.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The plain text contents of the master key file.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../com/pingidentity/sdk/key/MasterKeyEncryptorException.html" title="class in com.pingidentity.sdk.key">MasterKeyEncryptorException</a></code> - Thrown if failed to decrypt.</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/MasterKeyEncryptor.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../../com/pingidentity/sdk/key/MasterKeyEncryptorException.html" title="class in com.pingidentity.sdk.key"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/pingidentity/sdk/key/MasterKeyEncryptor.html" target="_top">Frames</a></li>
<li><a href="MasterKeyEncryptor.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>© Copyright 2023 Ping Identity. All rights reserved.</small></p>
</body>
</html>
